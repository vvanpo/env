#!/usr/bin/env bash

prefix="$1"

if [[ -z $prefix ]]; then
    2>&1 echo "Must provide a prefix path."
    exit 1
fi

. ~/"$prefix/src/$repo/init" -s

if [[ ! -d $prefix/bin ]] || [[ ! -e $prefix/bin/update-$name ]]; then
    mkdir -p "$prefix/bin"
    ln -s "../src/$repo/init" "$prefix/bin/update-$name"
fi

git_version="$(git --version | cut -d' ' -f3)"
github='https://raw.githubusercontent.com'
git_completion="git/git/v${git_version}/contrib/completion/git-completion.bash"
git_prompt="git/git/v${git_version}/contrib/completion/git-prompt.sh"
includes=("$github/$git_completion" "$github/$git_prompt")

function install-dot {
    for file in $@; do
        [[ -e ~/$file ]] && (set -x; rm -f ~/"$file")
        (set -x; ln -s "$prefix/src/$repo/$file" ~/"$file")
    done
}

function install-git {
    install-dot .gitignore
    rm -f ~/.gitconfig
    git config --global --add user.name "$(get-config user.name)"
    git config --global --add user.email "$(get-config user.email)"
    git config --global --add core.excludesfile '~/.gitignore'
}

function install-bash {
    install-dot .bashrc .bash_profile .bash_logout
    mkdir -p ~/.bash

    cd ~/.bash
    for url in "${includes[@]}"; do
        local file="$(basename "$url")"
        [[ -e $file ]] && (set -x; rm -f "$file")
        (set -x; curl -fsSLO "$url")
    done
    >/dev/null cd -
}

read-config 'user.name' 'Full name'
read-config 'user.email' 'E-mail'

install-dot .tmux.conf .vimrc
install-git
install-bash
