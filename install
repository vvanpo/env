#!/usr/bin/env bash

name="$1"
email="$2"

repo='github.com/vvanpo/env'
# Directories are relative to $HOME.
usr="${3:-.local}"
env="$usr/src/$repo"

git_version="$(git --version | cut -d' ' -f3)"
github='https://raw.githubusercontent.com'
git_completion="git/git/v${git_version}/contrib/completion/git-completion.bash"
git_prompt="git/git/v${git_version}/contrib/completion/git-prompt.sh"
includes=("$github/$git_completion" "$github/$git_prompt")

function install-dot {
    for file in $@; do
        [[ -e ~/$file ]] && (set -x; rm -f "$HOME/$file")
        (set -x; ln -s "$env/$file" ~/)
    done
}

function install-git {
    install-dot .gitignore
    rm -f ~/.gitconfig
    git config --global --add user.name "$name"
    git config --global --add user.email "$email"
    git config --global --add core.excludesfile '~/.gitignore'
}

function install-bash {
    install-dot .bashrc .bash_profile .bash_logout
    mkdir -p ~/.bash

    cd ~/.bash
    for url in "${includes[@]}"; do
        local file="$(basename "$url")"
        [[ -e $file ]] && (set -x; rm -f "$file")
        (set -x; curl -fsSLO "$url")
    done
    >/dev/null cd -
}

install-dot .tmux.conf .vimrc
install-git
install-bash
